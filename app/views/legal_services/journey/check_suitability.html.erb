<%= add_optional_error_prefix_to_page_title(@journey.errors) %>


<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <%= render partial: 'shared/error_summary', locals: { errors: @journey.errors } %>

    <div id="ccs-error-sum" class="govuk-error-summary govuk-visually-hidden" aria-labelledby="error-summary-title" role="alert" data-module="error-summary">
      <h2 class="govuk-error-summary__title" id="error-summary-title"><%= t('common.error_summary_title') %></h2>
      <div class="govuk-error-summary__body">
        <ul id="ccs-error-sum-list" class="govuk-list govuk-error-summary__list">
          <li>
            <a href="#legal_services_yes">
              <%= t('activemodel.errors.models.legal_services/journey/check_suitability.attributes.legal_services.inclusion') %>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <%= form_tag @form_path, class: :'css-form', autocomplete: :'off', method: :get do %>

      <%= hidden_fields_for_previous_steps_and_responses(@journey) %>

      <%= govuk_form_group_with_optional_error(@journey, :legal_services) do %>
        <%= govuk_fieldset_with_optional_error(@journey, :legal_services) do %>

          <legend class="govuk-fieldset__legend govuk-fieldset__legend--m govuk-!-font-weight-bold">
            <h1 class="govuk-fieldset__heading">
              <%= t('.heading') %>
            </h1>
          </legend>

          <span id="legal_services-error" class="govuk-error-message govuk-visually-hidden">
            <%= t('activemodel.errors.models.legal_services/journey/check_suitability.attributes.legal_services.inclusion') %>
          </span>

          <%= display_error(@journey, :legal_services) %>

          <div class="govuk-radios">
            <div class="govuk-radios__item">
              <%= radio_button_tag :legal_services, 'yes', checked?(params[:legal_services], 'yes'), class: 'govuk-radios__input', id: 'legal_services_yes' %>
              <%= label_tag :legal_services, t('.label_01'), class: 'govuk-label govuk-radios__label', for: 'legal_services_yes' %>
            </div>
            <div class="govuk-radios__item">
              <%= radio_button_tag :legal_services, 'yes', checked?(params[:legal_services], 'no'), class: 'govuk-radios__input', id: 'legal_services_no' %>
              <%= label_tag :legal_services, t('.label_02'), class: 'govuk-label govuk-radios__label', for: 'legal_services_no' %>
            </div>

            <div class="govuk-radios__divider govuk-!-margin-top-3 govuk-!-margin-bottom-3"><%= t('.or') %></div>

            <div class="govuk-radios__item">
              <%= radio_button_tag :legal_services, 'other', checked?(params[:legal_services], 'other'), class: 'govuk-radios__input', id: 'legal_services_other' %>
              <%= label_tag :legal_services, t('.label_03'), class: 'govuk-label govuk-radios__label', for: 'legal_services_other' %>
            </div>

          </div>
        <% end %>
      <% end %>
      <%= submit_tag t('common.submit'), id: "submit", class: "govuk-button govuk-!-padding-left-7 govuk-!-padding-right-7" %>
    <% end %>

  </div>
</div>

<script>
  function initFormVal(){

    $('#submit').click(function(e){
      var form = $('#main-content').find('form');
      var state = form.find('input[name="legal_services"]');

      if(state.prop("checked") == true){

        form.submit();

      }else{
        e.preventDefault();

        var title = $('html').children('head').find('title');
        title.text('Error: '+ title.text().replace(/Error: /g,''));

        state.parents('.govuk-form-group').addClass('govuk-form-group--error');

        $('#ccs-error-sum').attr('tabindex','-1').focus().add('#legal_services-error').removeClass('govuk-visually-hidden');
      }
    });

  }

  function isValidatorLoaded(){
    if(window.jQuery){ initFormVal(); }
    else{ window.setTimeout('isValidatorLoaded();',100); }
  }
  isValidatorLoaded();
</script>
