<%= render partial: 'shared/error_summary', locals: { errors: @journey.errors } %>

<% content_for :page_title, t('.heading') %>

<div class="procurement">
  <div class="services chooser-component">
    <div id="ccs-accordion-with-basket" class="govuk-grid-row">
      <%= form_tag @form_path, method: :get do %>
        <div class="govuk-grid-column-two-thirds">
          <%= hidden_fields_for_previous_steps_and_responses(@journey) %>
          <%= govuk_form_group_with_optional_error(@journey, :service_codes) do %>
            <%= govuk_fieldset_with_optional_error(@journey, :service_codes) do %>
              <div>
                <fieldset class="govuk-fieldset">
                <legend class="govuk-fieldset__legend">
                  <h1 class="govuk-heading-xl">
                    <%= t('.heading') %>
                  </h1>
                </legend>

                  <h2 class="govuk-heading-m">
                    <%= t('.question') %>
                  </h2>
                </fieldset>
                <p class="govuk-caption-m">
                  <%= t('.caption') %>
                </p>
                <p>
                  <%= service_specification_document('rm6232') %>
                </p>
                <p class="govuk-caption-m">
                  <%= t('.caption2') %>
                </p>
              </div>
              <div class="govuk-grid-column-full" style="padding-left:0">
                <%= form_tag 'choose-services/answer', method: :get do %>
                  <%= display_potential_errors(@journey.steps[0], :service_codes, '')%>
                  <div class="chooser-input">
                    <%= govuk_accordion('choose-services') do %>
                      <% @journey.current_step.work_packages.each_with_index do |work_package, index| %>
                        <%= govuk_accordion_add_section(index, work_package.name, class: 'chooser-section', data: { section: work_package.code, sectionname: work_package.name }) do %>
                          <% work_package.services.order(:sort_order).each do |service| %>
                            <div class="govuk-form-group chooser-input" sectionname="<%= work_package.name %>" section="<%= work_package.code %>">
                              <div aria-describedby='<%= "service_#{service.hyphenate_code}" %>'>
                                <div class="govuk-checkboxes">
                                  <div class="govuk-checkboxes__item">
                                    <%= check_box_tag("service_codes[]", service.code, @journey.current_step.service_codes.include?(service.code),
                                                      title: service.name,
                                                      class: "govuk-checkboxes__input",
                                                      sectionid: work_package.code,
                                                      id: "service_#{service.hyphenate_code}",) %>
                                    <label style="padding-top:0"
                                            class="govuk-label govuk-checkboxes__label"
                                            for="<%= "service_#{service.hyphenate_code}" %>">
                                      <%= service.name %>
                                      <br/>
                                      <span style="font-weight:lighter;"><%= service.description %></span>
                                      <div>
                                        <%#= link_to t('.learn_more'), facilities_management_rm6232_service_specification_path(service.hyphenate_code, work_package.code), target: '_blank' %>
                                        <%= t('.availiable_lots') %>
                                        <div class="govuk-grid-row">
                                          <% service.available_lots.each do |lot| %>
                                            <div class="govuk-grid-column-one-third">
                                              <p class="govuk-body"><%= govuk_tag_with_text(:grey, t(".service_type.#{lot}")) %></p>
                                            </div>
                                          <% end %>
                                        </div>
                                      </div>
                                    </label>
                                  </div>
                                </div>
                              </div>
                            </div>
                          <% end %>
                          <% if work_package.services.count > 1 &&  work_package.code != 'P' %>
                            <p><%= t('facilities_management.basket.or_text') %></p>
                            <div class="govuk-checkboxes">
                              <div class="govuk-checkboxes__item">
                                <input title="Select all code-<%= work_package.code %> services"
                                        style="margin-top:4px"
                                        class="govuk-checkboxes__input"
                                        id="<%= work_package.code %>_all"
                                        name="section-checkbox_select_all"
                                        forserviceid="<%= work_package.code %>"
                                        type="checkbox"
                                        value="<%= work_package.code %>">
                                <label class="govuk-label govuk-checkboxes__label"
                                        for="<%= work_package.code %>_all">
                                  <%= t('facilities_management.basket.selectall_text') %>
                                </label>
                              </div>
                            </div>
                          <% end %>
                        <% end %>
                      <% end %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% end %>
          <% params[:region_codes]&.split(" ") do |region_code| %>
            <%= hidden_field_tag "region_codes[]", region_code %>
          <% end %>
          <%= hidden_field_tag :sector_code, params[:sector_code] if params[:sector_code] %>
          <%= hidden_field_tag :contract_cost, params[:contract_cost] if params[:contract_cost] %>
          <%= submit_tag t('common.submit'), class: "govuk-button govuk-!-margin-bottom-4", aria: { label: t('common.submit') } %>
          <p><%= link_to t('.return_text'), facilities_management_rm6232_path, class: 'govuk-link' %></p>
        </div>
        <div class="govuk-grid-column-one-third govuk-!-margin-top-9">
          <div class="basket">
            <div>
              <h3 class="govuk-heading-m" data-txt01="<%= t('.services_selected') %>" data-txt02="<%= t('.no_services_selected') %>" data-txt03="<%= t('.service_selected') %>">
                <span id="selected-services-count">0</span> <span><%= t('.services_selected') %></span></h3>
              <a class="govuk-!-padding-left-2 remove-link" role="button" href="#" aria-label="<%= t('.remove_all') %>"><%= t('.remove_all') %></a><br/>
              <ul style="margin-top:10px;" class="govuk-list"></ul>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
