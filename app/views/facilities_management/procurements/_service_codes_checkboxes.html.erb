<fieldset class="govuk-fieldset">
  <h2 class="govuk-heading-m govuk-!-margin-bottom-0">
    <%= heading %>
  </h2>
</fieldset>
<p class="govuk-caption-m govuk-!-margin-top-0">
  <%= subtitle %>
</p>
<p>
  <a href="<%= Marketplace.service_information_doc %>" alt="<%= t('facilities_management.select_services.servicespec_link_alttext') %>"><%= service_specification_doc %></a>
</p>
<%= display_error @procurement, :service_codes %>
<div class="govuk-grid-column-full" style="padding-left:0">
  <div class="chooser-input">
    <div class="govuk-accordion" data-module="accordion" id="procurement-services-accordion">
      <% FacilitiesManagement::StaticData.services.each do |service| %>
        <div class="govuk-accordion__section chooser-section" data-section="<%= service['code'] %>" data-sectionname="<%= service['name'] %>">
          <div class="govuk-accordion__section-header">
            <h2 class="govuk-accordion__section-heading">
              <span class="govuk-accordion__section-button" id="<%= service['code'] %>"><%= service['name'] %></span>
            </h2>
          </div>
          <div id="<%= service['code'] %>-content" class="govuk-accordion__section-content" aria-labelledby="<%= service['code'] %>">
            <% FacilitiesManagement::StaticData.work_packages.select { |work_package| work_package['work_package_code'] == service['code'] }.each do |work_package| %>
              <div class="govuk-form-group chooser-input" sectionname="<%= service['name'] %>" section="<%= service['code'] %>">
                <fieldset class="govuk-fieldset" aria-describedby="<%= "#{work_package['code']}_description"%>">
                  <div id="services-checkboxes" class="govuk-checkboxes">
                    <div class="govuk-checkboxes__item">
                      <%= check_box_tag("facilities_management_procurement[service_codes][]", work_package['code'], @procurement.service_codes&.include?(work_package['code']),
                                        title: work_package['name'],
                                        class: "govuk-checkboxes__input",
                                        sectionid: service['code'],
                                        id: "facilities_management_procurement_service_codes_#{work_package['code'].gsub('.', '-')}",) %>
                      <label style="padding-top:0"
                              class="govuk-label govuk-checkboxes__label"
                              for="<%= "facilities_management_procurement_service_codes_#{work_package['code'].gsub('.', '-')}" %>">
                        <%= work_package['name'] %>
                        <br/>
                        <span style="font-weight:lighter;" id='<%= "#{work_package['code']}_description"%>'><%= work_package['description'] %></span>
                      </label>
                    </div>
                  </div>
                </fieldset>
              </div>
            <% end %>
            <% if FacilitiesManagement::StaticData.work_packages.select { |work_package| work_package['work_package_code'] == service['code'] }.count > 1 %>
              <p><%= t('facilities_management.basket.or_text') %></p>
              <div id="services-checkboxes" class="govuk-checkboxes">
                <div class="govuk-checkboxes__item">
                  <input title="Select all code-<%= service['code'] %> services"
                          style="margin-top:4px"
                          class="govuk-checkboxes__input"
                          id="<%= service['code'].sub('.', '-') %>_all"
                          name="section-checkbox_select_all"
                          forserviceid="<%= service['code'] %>"
                          type="checkbox"
                          value="<%= service['code'] %>">
                  <label class="govuk-label govuk-checkboxes__label"
                          for="<%= service['code'].sub('.', '-') %>_all">
                    <%= t('facilities_management.basket.selectall_text') %>
                  </label>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>