<%= form_for @building_service, url: facilities_management_procurement_buildings_service_path(@building_service.id), method: :put, html: {specialvalidation: true, novalidate: true, multipart: true} do |f| %>
    <% if f.object.errors.any? %>
    <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" data-module="error-summary">
      <h2 class="govuk-error-summary__title" id="error-summary-title">
        <%= t(".there_is_a_problem") %>
      </h2>
      <div class="govuk-error-summary__body">
        <ul class="govuk-list govuk-error-summary__list">
          <% if f.object.errors[:personnel].any? %>
            <li>
              <%= base_error_link(f.object, :personnel) %>
            </li>
          <% end %>
          <% f.object.service_hours.attributes.reject {|k, _| %i[uom personnel].include? k}.each do |key, value| %>
            <% if value.errors[:service_choice].present? %>
              <li>
                <%= error_summary_link(key, value, :service_choice) %>
              </li>
            <% end %>
            <% if value.errors[:start_time].present? %>
              <li>
                <%= error_summary_link(key, value, :start_time) %>
              </li>
            <% end %>
            <% if value.errors[:end_time].present? %>
              <li>
                <%= error_summary_link(key, value, :end_time) %>
              </li>
            <% end %>
          <% end %>
          <% if all_not_required?(f.object) %>
            <li>
              <%= base_error_link(f.object, :base) %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>
  <%= f.hidden_field :step, value: @partial_prefix %>
  <p class="govuk-!-margin-bottom-6 govuk-hint">
    <%= t('.service_hours_description_1') %>
  </p>
  <div class="servicehourscontainer">
    <div class="servicehoursdata">
      <div class="govuk-form-group <%= 'govuk-form-group--error' if f.object[:service_hours].errors[:personnel].any? %>">
        <h2 class="govuk-heading-m govuk-!-margin-bottom-2">
          <%= t('.personnel_subtitle') %>
        </h2>
        <%= f.fields_for :service_hours, f.object[:service_hours] do |sh| %>
          <%= display_error f.object, :personnel %>
          <%= sh.label :personnel, t('.number_of_personnel') %><br>
          <%= sh.number_field :personnel, class: "govuk-input govuk-input--width-3 ccs-integer-field govuk-!-margin-top-2 #{'govuk-input--error' if f.object[:service_hours].errors[:personnel].any?}" %>
        <% end %>
      </div>
      <h2 class="govuk-heading-m govuk-!-margin-bottom-4"><%= t('.service_hours_subtitle') %></h2>
      <div class="service_hours_container <%= 'govuk-form-group--error' if all_not_required?(f.object) %>">
        <% if all_not_required?(f.object) %>
          <%= display_error f.object, :base %>
        <% end %>
        <%= f.fields_for :service_hours, f.object[:service_hours] do |sh| %>
          <% sh.object.attributes.each do |key, _value| %>
            <% unless %i[uom personnel].include? key %>
              <%= sh.fields_for key, sh.object[key] do |day|%>
                <%= render partial: 'day_section', locals: { day: key, f: day, service_hours: sh.object, service_choice: day.object } %>
              <%end%>
            <%end %>
          <%end%>
        <%end%>
      </div>
    </div>
  </div>
  <div class="govuk-grid-row govuk-!-margin-top-9">
    <%= f.submit t('.save_and_return_to_service_information'), class: 'govuk-button govuk-button--primary govuk-!-margin-left-3 govuk-!-margin-bottom-4', data: { disable_with:false }, 'aria-label': t('.save_and_return_to_service_information') %>
  </div>
  <%= link_to t('.back_to_service_information'), facilities_management_procurement_building_path(@procurement_building), class: 'govuk-link--no-visited-state' %>
<% end %>
