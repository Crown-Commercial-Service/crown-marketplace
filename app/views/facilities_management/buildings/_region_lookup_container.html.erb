<div class="govuk-grid-row govuk-!-margin-top-4">
  <div class="govuk-grid-column-two-thirds" data-module="find-region">
    <%= form_group_with_error(f.object, :address_region) do |displayed_error| %>
      <div id="select-a-region" class="<%=hidden_class(select_a_region_visible?)%>">
        <span class="govuk-heading-s govuk-!-margin-bottom-1">
          <%= t('.region') %>
        </span>
        <span class="govuk-caption-m">
          <%= t('.region_desc') %>
        </span>
        <%= f.label :address_region, t('.select_a_region'), class: 'govuk-heading-s govuk-!-margin-top-3 govuk-!-margin-bottom-1', for: 'regions-container' %>
        <%= displayed_error %>
        <select class="govuk-select govuk-!-width-two-thirds <%= 'govuk-select--error' if f.object.errors.details[:address_region].any? %>"
                data-withdata-text-single="<%= t('.region_singular') %>"
                data-withdata-text-plural="<%= t('.region_plural') %>"
                tabindex=<%=input_visible?(select_a_region_visible?)%>
                id="regions-container">
          <optgroup label="<%= t('.option_text', number: valid_regions.length, location: 'region'.pluralize(valid_regions.length)) %>"></optgroup>
          <option value="">
            <%= valid_regions.length.zero? ? t('.option_text', number: 0, location: 'regions') : t('.please_select_a_region') %>
          </option>
          <%= valid_regions.each do |region| %>
            <option value="<%= region[:code] %>"
              <%= 'selected' if f.object.address_region_code == region[:code] %>
              data-address_region="<%= region[:region] %>"
              data-address_region_code="<%= region[:code] %>">
              <%= region[:region] %>
            </option>
          <% end %>
        </select>
      </div>
    <% end %>

    <div id="full-region" class="<%=hidden_class(full_region_visible?)%>">
      <span class="govuk-heading-s govuk-!-margin-bottom-1">
        <%= t('.region') %>
      </span>
      <div class="govuk-body govuk-!-margin-bottom-2" id="region-text">
        <%= f.object.address_region %>
      </div>
      <%= link_to t('.change'), '#select-a-region', class: "govuk-link #{'govuk-visually-hidden' unless multiple_regions?}", id: 'change-input-3', tabindex: input_visible?(full_region_visible? && !multiple_regions?) %>
    </div>

    <div id="hidden-region-fields">
      <%= f.hidden_field :address_region, id: 'address-region' %>
      <%= f.hidden_field :address_region_code, id: 'address-region-code' %>
    </div>
  </div>
</div>